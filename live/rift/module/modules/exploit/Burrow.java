package live.rift.module.modules.exploit;

import java.util.ArrayList;
import live.rift.module.Category;
import live.rift.module.Module;
import live.rift.setting.Setting;
import live.rift.util.BlockUtil;
import net.minecraft.network.play.client.CPacketPlayer.Position;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.Vec3d;

public class Burrow extends Module {

    public Setting mode;
    ArrayList modes = new ArrayList();
    BlockPos ogPosition;

    public Burrow() {
        super("Burrow", 0, Category.EXPLOITS);
        this.modes.add("Obby");
        this.modes.add("EChest");
        this.mode = new Setting("Mode", this, "Obby", this.modes);
    }

    public static Vec3d blockCenter(double posX, double posY, double posZ) {
        double x = Math.floor(posX) + 0.5D;
        double z = Math.floor(posZ) + 0.5D;

        return new Vec3d(x, posY, z);
    }

    public void onEnable() {
        this.ogPosition = new BlockPos(Math.floor(Burrow.mc.player.posX) + 0.5D, Burrow.mc.player.posY, Math.floor(Burrow.mc.player.posZ) + 0.5D);
        Vec3d blockCenter = blockCenter(Burrow.mc.player.posX, Burrow.mc.player.posY, Burrow.mc.player.posZ);

        Burrow.mc.player.motionX = 0.0D;
        Burrow.mc.player.motionZ = 0.0D;
        Burrow.mc.player.connection.sendPacket(new Position(blockCenter.x, blockCenter.y, blockCenter.z, true));
        Burrow.mc.player.setPosition(blockCenter.x, blockCenter.y, blockCenter.z);
        Burrow.mc.player.jump();
    }

    public void onUpdate() {
        if (Burrow.mc.player.posY > (double) this.ogPosition.getY() + 1.2D) {
            int slot;

            if (this.mode.getValString().equals("Obby")) {
                slot = BlockUtil.findObiInHotbar();
                if (slot != -1 && Burrow.mc.player.inventory.currentItem != slot) {
                    Burrow.mc.player.inventory.currentItem = slot;
                }
            } else if (this.mode.getValString().equals("EChest")) {
                slot = BlockUtil.findEChestInHotbar();
                if (slot != -1 && Burrow.mc.player.inventory.currentItem != slot) {
                    Burrow.mc.player.inventory.currentItem = slot;
                }
            }

            BlockUtil.placeBlockScaffold(this.ogPosition);
            Burrow.mc.player.motionY = 1.0D;
            this.disable();
        }

    }
}
